---
layout: post
title: Credit risk profiling using open bank data
date: '2019-01-17T10:23:00.000+02:00'
author: David Cristobal
tags:
nav_order: 9
modified_time: '2019-01-17T10:23:49.049+02:00'
thumbnail: https://1.bp.blogspot.com/-gtXPwYNviH0/XD8vYmBGVaI/AAAAAAAAACM/AnXuhwUF89Ardc1OJmgSwlKMBlS3zm2EgCLcBGAs/s72-c/forest_editorial.png
blogger_id: tag:blogger.com,1999:blog-3014413452006891711.post-7044825733412512893
blogger_orig_url: https://blog.boogiesoftware.com/2019/01/credit-risk-profiling-using-open-bank.html
---

<h2 style="text-align: center;">&nbsp;</h2><div style="text-align: justify;"><a href="https://1.bp.blogspot.com/-gtXPwYNviH0/XD8vYmBGVaI/AAAAAAAAACM/AnXuhwUF89Ardc1OJmgSwlKMBlS3zm2EgCLcBGAs/s1600/forest_editorial.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="720" data-original-width="1080" height="212" src="https://1.bp.blogspot.com/-gtXPwYNviH0/XD8vYmBGVaI/AAAAAAAAACM/AnXuhwUF89Ardc1OJmgSwlKMBlS3zm2EgCLcBGAs/s320/forest_editorial.png" width="320" /></a>Four months ago I was doing research in astrophysics in a Spanish institution and since then I made a change in my career moving to work in Finland. From October 2018 I am working at <a href="https://boogiesoftware.com/" rel="noopener nofollow" target="_blank">Boogie Software</a> inside the Artificial Intelligence Team. During the last months, our team has been working with bank data to study the information that can be extracted from it. We are making developments in data synthesis using Deep Learning and customer profiling (please find more information in <a href="https://boogiesoftware.com/ai/" rel="noopener nofollow" target="_blank">Boogie AI</a>).</div><div style="text-align: justify;">In this post I describe a possible use of bank data. The objective is to make the profile of the client according to the transaction history and predict the success of a potential loan. The selected bank data is from a real Czech bank. It was released anonymized in 1999 and is one of the largest open bank data sets. It contains around 1 million transactions for 4500 accounts. It also provides information about the client products, as loans or credit cards, and other demographic information such as the age and gender of the client, or data about the client’s district.</div><div style="text-align: justify;">In this study the goal is to predict how well a client will carry out with the future payments of a loan. In the data there is information about the status of payments for each given loan. The payment status is divided into four categories. The categories describe if the contract is finished or running and if the client has complied with all the monthly payments or if he/she is in default. For this exercise, I divided the loans into two classes depending only on the payment status. The “on schedule” class means that the loan is running or has finished without problems. The “in default” class means that the client has been in default for some months.</div><div style="text-align: justify;">It is worth mentioning that, although some loans are classified as "in default", often the client has continued making payments. Often, even at the end of the contract, the balance in the account associated with the loan is positive. For example, the following figure shows the number of outstanding payments and the percentage of the loan that remains unpaid. The figure shows how for the “in default” loans the client actually paid a large part of them. In most cases, the client's balance is in good shape to pay the remaining amounts.</div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-0fth7baouCw/XD8rkXZiQeI/AAAAAAAAAB4/2en3QmAqKMUhZXoIdIYmgmWI9vqloQyBQCLcBGAs/s1600/figure1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="650" data-original-width="1088" height="380" src="https://1.bp.blogspot.com/-0fth7baouCw/XD8rkXZiQeI/AAAAAAAAAB4/2en3QmAqKMUhZXoIdIYmgmWI9vqloQyBQCLcBGAs/s640/figure1.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><h3><b>Generating the feature vector</b></h3><div style="text-align: justify;">The exercise here is to classify each loan as “on schedule” or “in default”  using a feature vector for each client. To generate the features, one  has to use the information available before each loan started. For this  purpose, monthly averaged properties are computed for each account  associated with a loan. Some of these properties are, for example, the  average, minimum and maximum balance, the number of incoming and  outgoing transactions and some statistics on the associated amounts.  Finally, these average properties are referred to the start date of each  loan. The following graph shows the average monthly balance stacked for  all the clients with loans. The shaded areas in the figure represents  the uncertainty. One can see the difference in the loans that go into  default.<b> </b></div><div style="text-align: justify;"><b><br /></b></div><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-LAnRdctfWQg/XD8rsnRM-qI/AAAAAAAAAB8/Qd4cd8ZFsTIaLSNmN41PFbOdenHgboz4gCLcBGAs/s1600/figure2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="668" data-original-width="1086" height="392" src="https://2.bp.blogspot.com/-LAnRdctfWQg/XD8rsnRM-qI/AAAAAAAAAB8/Qd4cd8ZFsTIaLSNmN41PFbOdenHgboz4gCLcBGAs/s640/figure2.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div style="text-align: justify;"><br />The monthly aggregated values for the three months before the loan  started are used in the final feature vector. Other information is also  used, as for example, information relative to the loan itself, the client products, and demographic information.</div><h2>Predicting loan potential risk</h2>First, it is necessary to select the metric and a simple prediction as baseline. I choose to use the accuracy defined as (correct predictions)/(total sample size). One should note that the number of loans is actually very low. There are only 682 loans and only 76 of them are “in default”. Under these circumstances a good baseline model is to predict that all loans are "on schedule", which yield a good accuracy score of 0.89. It’s fair to assume that this would be due to the bank using their own tools for selecting which amount of loan it grants to which client, and also because of the client’s commitment to pay back.<br /><br /><br /><a href="https://1.bp.blogspot.com/-LXfEWKrYrng/XD8DdyB1UWI/AAAAAAAAABM/IfAXcAaIGq0OopFYa7_2Eh-afAQ7W-CXwCLcBGAs/s1600/figure_3a.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" data-original-height="455" data-original-width="623" height="232" src="https://1.bp.blogspot.com/-LXfEWKrYrng/XD8DdyB1UWI/AAAAAAAAABM/IfAXcAaIGq0OopFYa7_2Eh-afAQ7W-CXwCLcBGAs/s320/figure_3a.png" width="320" /></a>In a first approximation it is good to see the potential of some basic classifiers like Logistic Regression or Naive Bayes. At is is shown in the next figure one can get slight better results than the baseline model.<br /><br /><br />Classifiers based on decision trees bagging produce better results as shown in the following figure.<br /><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-QrjbEWLXp7E/XD8DnvY0JDI/AAAAAAAAABQ/hMIv7y8UF70nURpem9VuOFIJR3PdPtIRACLcBGAs/s1600/figure3_b.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" data-original-height="455" data-original-width="623" height="233" src="https://1.bp.blogspot.com/-QrjbEWLXp7E/XD8DnvY0JDI/AAAAAAAAABQ/hMIv7y8UF70nURpem9VuOFIJR3PdPtIRACLcBGAs/s320/figure3_b.png" width="320" /></a></div><div style="text-align: justify;">Also an advantage of the models based on decision trees is that they are  able to rank the feature importance. The following figure shows which  features play a significant role in the prediction. One can see how the  analysis done on the client transaction history allows to improve the  prediction. One could assume that the balance in the account before  granting the loan is an important feature. However, one also understands  that often someone needs a loan when the balance is not very high.</div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-jyg8CetUFZ4/XD8D3bRJ3cI/AAAAAAAAABc/eh0fwL4sozMEdGEGCdzdC9Sgqm_dTxH8gCLcBGAs/s1600/figure4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="866" data-original-width="858" height="640" src="https://3.bp.blogspot.com/-jyg8CetUFZ4/XD8D3bRJ3cI/AAAAAAAAABc/eh0fwL4sozMEdGEGCdzdC9Sgqm_dTxH8gCLcBGAs/s640/figure4.png" width="633" /></a></div><div style="text-align: justify;"><br /></div><h3>Rank the probability of loan success</h3><div style="text-align: justify;">Finally, some classifiers provide a probability for an item to be in a class. We can use these probabilities to rank the loans. In this exercise, a random forest classifier is used to rank the loans using the probability of success. The following figures show the loan success rate for the percentage of the sample that is most likely to be "on schedule" according to the classifier. To produce the curves, the model is trained several times with different random subsets of the loans and the predictions are analyzed on the complementary data. The figures show the average for all the iterations and its standard deviation.</div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-wrJrSpooGRI/XD8EGF8D4tI/AAAAAAAAABg/fXS90D475o4IZcTmvrP8PzsUWb298u70QCLcBGAs/s1600/figure5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="644" data-original-width="940" height="435" src="https://3.bp.blogspot.com/-wrJrSpooGRI/XD8EGF8D4tI/AAAAAAAAABg/fXS90D475o4IZcTmvrP8PzsUWb298u70QCLcBGAs/s640/figure5.png" width="640" /></a></div><div style="text-align: justify;"><br /></div><h3>Final remarks</h3><div style="text-align: justify;">In this article, I used one of the largest open bank data sets to make predictions about how well a client will deal with future loan payments. A similar project could be done (surely it is being done) with real data. The information from these studies will be useful for both the bank and the client. This kind of analysis can be used to adjust the length of the loan and the payments to make them more affordable for the client during the loan period.</div><div style="text-align: justify;">Some questions can be raised about the current exercise. On the features side, it is possible that the account has a specific purpose. Also, is possible that the clients have other accounts for other purposes or in other banks. All this information should be aggregated in the feature vector. On the data side, there is a selection of the clients and the loans, so the results are biased towards “on schedule” loans. In fact, even the loans classified as “in default” have been returned mostly, and in the rest, often the clients seem able to complete the payments. This could suggest a tight selection of the clients granted with a loan.</div><div style="text-align: justify;">If you find this topic interesting, please find more&nbsp;info about our <a href="https://boogiesoftware.com/ai/" rel="noopener nofollow" target="_blank">AI team</a> offering and do not hesitate to drop a line if you want to discuss more.</div><h3>References</h3><ul><li><a href="https://boogiesoftware.com/" rel="noopener nofollow" target="_blank">Boogie Software</a> Oy is a private Finnish company headquartered in Oulu, Finland. Our unique company profile builds upon top level software competence, entrepreneurial spirit and humane work ethics. The key to our success is close co-operation with the most demanding customers, understanding their business and providing accurate software solutions for complex problems.</li><li>The open bank data used in the article can be found in the following link <a href="https://sorry.vse.cz/~berka/challenge/" rel="noopener nofollow" target="_blank">https://sorry.vse.cz/~berka/challenge/</a></li><li>A more detailed analysis with additional figures in Jupyter notebooks is available in the following github repository <a href="https://github.com/dchornillos/explore_financialdata/" rel="noopener nofollow" target="_blank">explore-financial-data</a>.</li><li>The analysis has been done using <a href="http://www.numpy.org/" rel="noopener nofollow" target="_blank">numpy</a>, <a href="https://pandas.pydata.org/" rel="noopener nofollow" target="_blank">pandas</a> and <a href="https://scikit-learn.org/stable/" rel="noopener nofollow" target="_blank">scikit-learn</a> Python libraries. The figures have been generated using <a href="https://matplotlib.org/" rel="noopener nofollow" target="_blank">matplotlib</a> and <a href="https://seaborn.pydata.org/" rel="noopener nofollow" target="_blank">seaborn</a> libraries.</li></ul><div style="text-align: justify;"><br /></div>